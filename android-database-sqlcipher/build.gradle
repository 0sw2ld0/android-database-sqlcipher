apply plugin: 'com.android.library'

android {

  compileSdkVersion 26
  buildToolsVersion "26.0.1"

  defaultConfig {
    minSdkVersion 14
    targetSdkVersion 26
    versionCode 1
    versionName "1.0"
  }

  buildTypes {
    release {
      minifyEnabled false
      //proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  externalNativeBuild {
    ndkBuild {
      path "${projectDir}/src/main/cpp/Android.mk"
    }
  }

  task buildOpenSSL (type:Exec) {
    workingDir "${projectDir}"
    commandLine "./build-openssl-libraries.sh"
  }

  task buildAmalgamation () {
    doLast {
      exec {
        workingDir "${projectDir}/src/main/external/sqlcipher"
        environment("CFLAGS", "${rootProject.ext.sqlcipherCFlags}")
        commandLine "./configure", "--enable-tempstore=yes", "--with-crypto-lib=none"
      }
      exec {
        workingDir "${projectDir}/src/main/external/sqlcipher"
        environment("CFLAGS", "${rootProject.ext.sqlcipherCFlags}")
        commandLine "make",  "sqlite3.c"
      }
    }
  }

  preBuild.dependsOn buildAmalgamation

  // task cleanOpenSSL() {
  //   println "OpenSSL dir:${rootProject.ext.opensslDir}"
  //   println "Cleaning OpenSSL"
  // }

  // task cleanSQLCipher() {
  //   println "SQLCipher dir:${rootProject.ext.sqlcipherDir}"
  //   println "Cleaning SQLCipher"
  // }

}

dependencies {
  compile fileTree(dir: 'libs', include: ['*.jar'])
}
